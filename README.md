# Backend

This project is based on Sugardaddy's libraries and project structure. The flow is basically the same, but custom libraries by Synapse
and tools are replaced by open-source alternative that has the same principles with Synapse's.

## General

- `interface`s are declared on the modules that needs it.
- Returning a `struct` is preferred over `interface`.
- Accepting `interface` as parameter is preferred over `struct`.

## Server

The server executable is found under `./cmd/pet_api/main.go` file. I tried to make it similar to Synapse's as possible.

## HTTP Layer (Usecase)

This project uses [ogen](https://github.com/ogen-go/ogen) to generate the http layer. This is the equivalent of Synapse's `kit.sh`.
The difference is that instead of writing the endpoint configuration in go, you have to write it in Open API Specification (OAS).
A command in Makefile is created to automate this process. Using Cursor to modify the Open API Specification is highly recommended.
The generated files are ignored and not commited as commiting generated files are not usually a best practice.

How ogen works is looks at OAS, then generate boilerplate codes, stucts and an interface that you need to implement to do the business
logic.

### Structure

- **OAS:** Located under `openapi/` directory.
- **Service:** The implementation of the interface that ogen generates are called `Services` and located in
  `usecase/<domain>svc/service.go` which is similar to Synapse's structure.
- **Generated Files:** The generated files are located in the `.gen` folder but we can't see that in the repo since it's ignored.

## Database Layer (Domain)

For this one, [jet](https://github.com/go-jet/jet) is used to replace `mysql.sh` of Synapse. This is more convinient as it's more akin
to writing to plain queries and preserves the benefit of Synapse's custom library which is to have typed definitions of the database.

### Structure

- **Repo:** The implementations of Repos and Domain Services are under `./infra/sqlite/` folder (`./infra/mysql` in Synapse).
- **Generated Files:** The generated files are located in the `.gen` folder but we can't see that in the repo since it's ignored.
- **Entities:** Entities are not defined by the dev anymore and generated by `jet`.
- **Domain Service and Repo Interfaces:** Domain interfaces and repos are not defined under domain anymore, instead they are declared
  in the usecase layer.

## Developing

### Requirements

- [ogen](https://github.com/ogen-go/ogen)
- [jet](https://github.com/go-jet/jet)
- The database project in the same level of directory (similar to Synapse)

### Building

1. Run `make gen-oas` in the root folder to generate the boilerplate for usecase
2. Run `make gen-db` in the root folder to generate the boilerplate for database
3. Run `go run ./cmd/pet_api/.` to run the server
